'use strict';

var crossvent = require('crossvent');
var throttle = require('./throttle');

function bullseye (el, target, options) {
  var o = options || {};
  var destroyed = false;
  var throttledPosition = throttle(position, 30);

  position();

  if (o.tracking !== false) {
    crossvent.add(window, 'resize', throttledPosition);
  }

  return {
    refresh: position,
    destroy: destroy
  };

  function position () {
    if (destroyed) {
      throw new Error('Bullseye can\'t refresh after being destroyed. Create another instance instead.');
    }
    var bounds = target.getBoundingClientRect();
    var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
    el.style.top  = bounds.top + scrollTop + target.offsetHeight + 'px';
    el.style.left = bounds.left + 'px';
  }

  function destroy () {
    crossvent.remove(window, 'resize', throttledPosition);
    destroyed = true;
  }
}

module.exports = bullseye;
